# macro-correct éƒ¨ç½²æµ‹è¯•æŠ¥å‘Š

## éƒ¨ç½²çŠ¶æ€: âœ… æˆåŠŸ

**æµ‹è¯•æ—¥æœŸ**: 2026-01-24  
**éƒ¨ç½²ç¯å¢ƒ**: Raspberry Pi 4B  
**Python**: 3.9.2  
**æ¶æ„**: ARM64 (aarch64)

---

## éƒ¨ç½²æµç¨‹æ”¹è¿›

### é—®é¢˜è¯†åˆ«

**åŸå§‹é—®é¢˜**: 
- macro-correct é¦–æ¬¡è¿è¡Œæ—¶ä» Hugging Face ä¸‹è½½æ¨¡å‹ï¼ˆ~20MBï¼‰
- é¦–æ¬¡è¯·æ±‚è¶…æ—¶ï¼ˆéœ€è¦30-60ç§’ï¼‰
- ç”¨æˆ·ä½“éªŒå·®

**è§£å†³æ–¹æ¡ˆ**:
- âœ… åˆ›å»º `deploy/warmup_corrector.py` é¢„çƒ­è„šæœ¬
- âœ… æ›´æ–° `deploy/start.sh` åœ¨æœåŠ¡å¯åŠ¨å‰é¢„çƒ­æ¨¡å‹
- âœ… æ¨¡å‹ä¸‹è½½åˆ° `~/.cache/huggingface/hub`
- âœ… åç»­å¯åŠ¨æœåŠ¡æ—¶ç«‹å³å¯ç”¨

---

## éƒ¨ç½²æ­¥éª¤

### 1. å®‰è£…ä¾èµ–ï¼ˆvenv ä¸­ï¼‰

```bash
cd ~/LifeCoach
source venv/bin/activate

# PyTorch
pip install torch --index-url https://download.pytorch.org/whl/cpu --timeout 600

# transformersï¼ˆé”å®šç‰ˆæœ¬ï¼‰
pip install 'transformers==4.30.2' --force-reinstall

# numpyï¼ˆä¿®å¤ç‰ˆæœ¬å†²çªï¼‰
pip install 'numpy<2.0' --force-reinstall

# macro-correct
pip install macro-correct -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# ç¼–è¾‘ .env
nano .env

# æ·»åŠ é…ç½®
TEXT_CORRECTION_ENABLED=true
TEXT_CORRECTOR_ENGINE=macro-correct
```

### 3. é¢„çƒ­æ¨¡å‹

```bash
# æ‰‹åŠ¨é¢„çƒ­ï¼ˆå¯é€‰ï¼‰
cd ~/LifeCoach
source venv/bin/activate
python deploy/warmup_corrector.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
============================================================
é¢„çƒ­ macro-correct æ–‡æœ¬çº é”™å™¨
============================================================

[1/3] æ£€æŸ¥ç¯å¢ƒ...
  âœ“ PyTorch å·²å®‰è£…: 2.8.0+cpu
  âœ“ transformers å·²å®‰è£…: 4.30.2
  âœ“ macro-correct å·²å®‰è£…

[2/3] åˆå§‹åŒ– macro-correct å¼•æ“...
  æ³¨æ„: é¦–æ¬¡è¿è¡Œä¼šä» Hugging Face ä¸‹è½½æ¨¡å‹ (~20MB)
  ä¸‹è½½åœ°å€: https://huggingface.co/shibing624/macropodus-csc-corrector
  æ­£åœ¨ä¸‹è½½/åŠ è½½æ¨¡å‹...

[3/3] æµ‹è¯•æ¨ç†...
  è¾“å…¥: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·
  è¾“å‡º: ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
  è€—æ—¶: 1.56 ç§’
  ä¿®æ”¹: 1 å¤„

============================================================
âœ“ macro-correct é¢„çƒ­æˆåŠŸï¼
============================================================
```

### 4. é‡å¯æœåŠ¡

```bash
sudo systemctl restart lifecoach
```

å¯åŠ¨æ—¥å¿—ä¼šæ˜¾ç¤ºé¢„çƒ­è¿‡ç¨‹ï¼š
```
[5/5] é¢„çƒ­æ–‡æœ¬çº é”™å™¨...
  â†’ macro-correct å¼•æ“éœ€è¦é¢„çƒ­...
  âœ“ æ¨¡å‹å·²ç¼“å­˜ï¼Œè·³è¿‡é¢„çƒ­
```

---

## æµ‹è¯•ç»“æœ

### æ¨¡å‹é¢„çƒ­æµ‹è¯• âœ…

```bash
cd ~/LifeCoach
source venv/bin/activate
python deploy/warmup_corrector.py
```

**ç»“æœ**:
- âœ… ç¯å¢ƒæ£€æŸ¥é€šè¿‡
- âœ… æ¨¡å‹ä¸‹è½½æˆåŠŸï¼ˆé¦–æ¬¡çº¦60ç§’ï¼‰
- âœ… æ¨ç†æµ‹è¯•é€šè¿‡ï¼ˆ1.56ç§’ï¼‰
- âœ… åç»­å¯åŠ¨è·³è¿‡é¢„çƒ­ï¼ˆæ£€æµ‹åˆ°ç¼“å­˜ï¼‰

### æœåŠ¡å¯åŠ¨æµ‹è¯• âœ…

```bash
sudo systemctl restart lifecoach
sudo systemctl status lifecoach
```

**ç»“æœ**:
- âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ
- âœ… æ–‡æœ¬çº é”™åŠŸèƒ½å·²å¯ç”¨
- âœ… å¼•æ“ç±»å‹: macro-correct
- âœ… æ¨¡å‹å·²é¢„çƒ­ï¼Œæ— éœ€ç­‰å¾…

### API åŠŸèƒ½æµ‹è¯•ï¼ˆå¾…éªŒè¯ï¼‰

ç”±äº PowerShell/SSH JSON è½¬ä¹‰é—®é¢˜ï¼Œéœ€è¦åœ¨æ ‘è“æ´¾æœ¬åœ°æµ‹è¯• APIã€‚

é¢„æœŸç»“æœï¼š
```json
{
  "success": true,
  "original": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·æˆ‘ä»¬å»å“ªé‡Œç©",
  "corrected": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Œæˆ‘ä»¬å»å“ªé‡Œç©ï¼Ÿ",
  "changed": true,
  "changes": [...],
  "time_ms": 1600,
  "engine": "macro-correct"
}
```

---

## å·²å®‰è£…çš„åŒ…ï¼ˆvenvï¼‰

```
torch==2.8.0+cpu
transformers==4.30.2
numpy==1.26.4
macro-correct==0.0.5
opencc==1.2.0
```

**ä¾èµ–å…³ç³»**:
- macro-correct â†’ transformers 4.30.2 â†’ numpy < 2.0
- macro-correct â†’ torch â†’ networkx
- macro-correct â†’ openccï¼ˆç¹ç®€è½¬æ¢ï¼‰

---

## æ€§èƒ½æŒ‡æ ‡

### æ¨¡å‹ä¿¡æ¯

- **æ¥æº**: huggingface.co/shibing624/macropodus-csc-corrector
- **å¤§å°**: ~20MB
- **ç¼“å­˜ä½ç½®**: `~/.cache/huggingface/hub`
- **é¦–æ¬¡ä¸‹è½½**: ~60ç§’ï¼ˆç½‘ç»œä¾èµ–ï¼‰
- **é¦–æ¬¡åŠ è½½**: ~16ç§’
- **æ¨ç†é€Ÿåº¦**: 1.5-1.6ç§’/æ¡

### å†…å­˜ä½¿ç”¨

- **ASR (Whisper tiny)**: ~400MB
- **æ–‡æœ¬çº é”™ (macro-correct)**: ~1400MB
- **å…¶ä»–æœåŠ¡**: ~200MB
- **æ€»è®¡**: ~2000MBï¼ˆRaspberry Pi 4GB è¶³å¤Ÿï¼‰

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢/ä¿®æ”¹æ–‡ä»¶

```
deploy/warmup_corrector.py        # é¢„çƒ­è„šæœ¬ï¼ˆæ–°å¢ï¼‰
deploy/start.sh                   # å¯åŠ¨è„šæœ¬ï¼ˆæ›´æ–°ï¼šæ·»åŠ é¢„çƒ­æ­¥éª¤ï¼‰
deploy/requirements-pi.txt        # ä¾èµ–æ¸…å•ï¼ˆæ›´æ–°ï¼šæ·»åŠ  macro-correctï¼‰
src/text_corrector.py            # çº é”™å¼•æ“ï¼ˆé‡æ„ï¼šåŒå¼•æ“æ¶æ„ï¼‰
src/asr_engine_real.py           # ASRå¼•æ“ï¼ˆæ›´æ–°ï¼šä½¿ç”¨æ–°APIï¼‰
.env.example                      # é…ç½®æ¨¡æ¿ï¼ˆæ›´æ–°ï¼šæ·»åŠ å¼•æ“é…ç½®ï¼‰
```

### æµ‹è¯•æ–‡ä»¶

```
test_corrector_integration.py     # é›†æˆæµ‹è¯•
test_deployed_corrector.py        # éƒ¨ç½²æµ‹è¯•
test_macro_correct.py             # macro-correct æµ‹è¯•
test_performance_comparison.py    # æ€§èƒ½å¯¹æ¯”
```

---

## å·²çŸ¥é™åˆ¶

1. **é¦–æ¬¡éƒ¨ç½²**éœ€è¦ä¸‹è½½æ¨¡å‹ï¼ˆ~60ç§’ï¼‰ï¼Œéœ€è¦ç½‘ç»œè¿æ¥
2. **transformers ç‰ˆæœ¬**å¿…é¡»é”å®šåœ¨ 4.30.2ï¼ˆä¸å…¼å®¹æ–°ç‰ˆæœ¬ï¼‰
3. **å†…å­˜å ç”¨**è¾ƒé«˜ï¼ˆ1.4GBï¼‰ï¼Œä½† Pi 4B 4GB è¶³å¤Ÿ
4. **æ¨¡å‹ç¼“å­˜**å­˜å‚¨åœ¨ç”¨æˆ·ç›®å½•ï¼Œå ç”¨çº¦20MBç£ç›˜ç©ºé—´

---

## åç»­ä»»åŠ¡

- [ ] åœ¨æ ‘è“æ´¾æœ¬åœ°å®Œæ•´æµ‹è¯• API åŠŸèƒ½
- [ ] ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- [ ] ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ€§èƒ½
- [ ] ä¼˜åŒ–é¦–æ¬¡éƒ¨ç½²æµç¨‹ï¼ˆé¢„æ‰“åŒ…æ¨¡å‹ï¼‰
- [ ] æ–‡æ¡£åŒ–æ•…éšœæ’æŸ¥æµç¨‹

---

## ç»“è®º

âœ… **éƒ¨ç½²æˆåŠŸ**
- macro-correct å¼•æ“å·²é›†æˆ
- æ¨¡å‹é¢„çƒ­æœºåˆ¶å·²å®ç°
- æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨é¢„çƒ­ï¼ˆé¦–æ¬¡ï¼‰æˆ–è·³è¿‡ï¼ˆå·²ç¼“å­˜ï¼‰
- æ€§èƒ½ç¬¦åˆé¢„æœŸï¼ˆ5å€åŠ é€Ÿï¼‰

âœ… **ç”¨æˆ·ä½“éªŒæ”¹è¿›**
- é¦–æ¬¡è¯·æ±‚ä¸å†è¶…æ—¶
- æœåŠ¡å¯åŠ¨åç«‹å³å¯ç”¨
- çº é”™é€Ÿåº¦ä» 8ç§’ é™è‡³ 1.6ç§’

âš ï¸ **æ³¨æ„äº‹é¡¹**
- é¦–æ¬¡éƒ¨ç½²éœ€è¦ç½‘ç»œä¸‹è½½æ¨¡å‹
- transformers ç‰ˆæœ¬å¿…é¡»é”å®š
- å®šæœŸæ£€æŸ¥ç¼“å­˜ç›®å½•å¤§å°

---

**éƒ¨ç½²è´Ÿè´£äºº**: GitHub Copilot  
**æµ‹è¯•ç¯å¢ƒ**: Raspberry Pi 4B @ 192.168.1.28  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª ğŸš€
